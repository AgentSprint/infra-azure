name: New Infra (POC)

on:
  workflow_dispatch:
    inputs:
      client_code:
        description: 'Client code to deploy'
        required: true
        type: string
      location:
        description: 'Location to deploy the client code'
        required: true
        type: string
      issue_api_url:
        description: 'URL of the issue to update'
        required: true
        type: string

permissions:
  contents: read
  issues: write   # required to comment

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Echo received inputs
        run: |
          echo "===== New Infra POC ====="
          echo "Client code: ${{ inputs.client_code }}"
          echo "Location: ${{ inputs.location }}"
          echo "Issue API URL: ${{ inputs.issue_api_url }}"
    #   - name: Comment back on issue
    #     run: |
    #       curl -sS -L -X POST \
    #       -H "Accept: application/vnd.github+json" \
    #       -H "Authorization: Bearer $ {{ secrets.GH_TOKEN }}" \
    #       -H "X-GitHub-Api-Version: 2022-11-28" \
    #       "$ {{ inputs.issue_api_url }}/comments" \
    #       -d "{\"body\": \"✅ Infra workflow received values: client_code=$ {{ inputs.client_code }}, location=$ {{ inputs.location }}\"}"


      - name: Comment back to the request issue
        uses: AgentSprint/utils-actions/comment-on-issue@main
        with:
            issue_api_url: ${{ inputs.issue_api_url }}
            body: |
                ✅ Infra workflow received values:
                - client_code: ${{ inputs.client_code }}
                - location: ${{ inputs.location }}
            token: ${{ secrets.GH_TOKEN }}